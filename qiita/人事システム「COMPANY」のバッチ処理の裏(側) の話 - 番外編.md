せっかく [人事システム「COMPANY」のバッチ処理の裏(側) の話](https://qiita.com/e99h2121/items/d9a83a6e47a53dcfbfbd) を書いたのでこいつが如何なるやつかをもう少し書いておきたくなりました。

[Develop fun!を体現する Works Human Intelligence Advent Calendar 2020](https://qiita.com/advent-calendar/2020/whi)
[Develop fun!を体現する Works Human Intelligence #2 Advent Calendar 2020](https://qiita.com/advent-calendar/2020/whi-2)
Works Human Intelligence アドベントカレンダー 12/5 の記事の補足です。

## キューはどこからやってくるのでしょう

[人事システム「COMPANY」のバッチ処理の裏(側) の話](https://qiita.com/e99h2121/items/d9a83a6e47a53dcfbfbd)
上の話で出てきた「キュー管理サービス」というやつ。
キューは文字通りのQueueなんですがどうやって順番を管理しているかというとJava内のほかにもう一つ投入口が用意されている。下位互換的にそういう仕上がりになっている。「キュー受付テーブル」と一旦呼ぶことにしよう。

```batchmanager.java
//「キュー受付テーブル」にレコードが入る。
//　　　↓
//「キュー管理スレッド」がそれを検知。
//　　　↓
//　ジョブ処理待ちへ
```

的な流れ。これはこれでただのバッチ処理機構の内輪の話で「キュー受付テーブル」にレコードを投入するには投入するための関数を使ってやるのが最も正式なお作法。

```batchmanager.java
//　★投入関数を使って呪文をとなえる（いくつか呪文には種類があります）
//　　　↓
//「キュー受付テーブル」にレコードが入る。
//　　　↓
//「キュー管理スレッド」がそれを検知。
//　　　↓
//　ジョブ処理待ちへ
```

と、言いたいのだが、さてこれが仕様であるとしてこの「バッチ処理」を使いたい各種プロダクトやサブシステムはどうしているか。「★のとおり呪文をとなえている」というのはもちろん大多数なんですがここで語りたい話ではない。とりあえず以下2つ知ってるからここに書いておく。


### その１

★に代わる（使用者さんにとって）いい感じの投入関数を自分で作っている。

作っている。なぜそうされたかはわからないが自作されている。なんか、★で提供している関数が機能不足だったんだと思う。それで動いているのだからすごいけど、何だろう。今度真面目にこちら側から読まないといけないと思っている。


### その２
「キュー受付テーブル」に自分でレコードを突っ込む。

もう少しオレオレなアプローチ。関数をいくら隠ぺいしてもテーブルはPublicでしたーーーーー！ってことだな。
内部にお詳しい者の昔からの知見と思われる。これも問題なく動いている。動いているけどさー、これもそろそろどうにかならないのかなと思っている。


## コンウェイの法則

[コンウェイの法則](https://www.yamdas.org/column/technique/19laws.html)

> ソフトウェアのどの部分であれ、それを作った組織の構造を反映する。
Any piece of software reflects the organizational structure that produced it
備考：原文ではこれの応用として「コンパイラを4つのグループで作れば、4パスコンパイラになる」というのが紹介されている

２つの例が組織の構造を反映しているとして果たしてどう比喩されたもんだかなのですが、なんか密なのか疎なのかという以前にバッチ機構の中身が透けて見えているかのようなのでいい感じに作っておけば動くからまあいっかの結果なのかなあ。ていうかそれオープンな組織だね！（自慢じゃない

以上休日にゆるりと楽しんでいただきたい小話でした。
